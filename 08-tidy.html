<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Tidy Data – Data Science and Society with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./exercises.html" rel="next">
<link href="./07-eda.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-tidy.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tidy Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science and Society with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/statds/1010f25" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Data-Science-and-Society-with-R.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preliminaries</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting up Computing Environment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Project Management with Git</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Jump Start with R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-encounter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">First Impression with Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-visual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-tidy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tidy Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
  <li><a href="#tibbles" id="toc-tibbles" class="nav-link" data-scroll-target="#tibbles"><span class="header-section-number">8.2</span> Tibbles</a></li>
  <li><a href="#tidy-up-data" id="toc-tidy-up-data" class="nav-link" data-scroll-target="#tidy-up-data"><span class="header-section-number">8.3</span> Tidy up data</a></li>
  <li><a href="#relational-data" id="toc-relational-data" class="nav-link" data-scroll-target="#relational-data"><span class="header-section-number">8.4</span> Relational Data</a></li>
  <li><a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings"><span class="header-section-number">8.5</span> Strings</a></li>
  <li><a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"><span class="header-section-number">8.6</span> Factors</a></li>
  <li><a href="#datetime" id="toc-datetime" class="nav-link" data-scroll-target="#datetime"><span class="header-section-number">8.7</span> Date/Time</a></li>
  </ul>
<div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/statds/1010f25/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/statds/1010f25/blob/main/08-tidy.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tidy Data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>Working effectively with data in R is greatly simplified by the <code>tidyverse</code>, a collection of packages designed for data science. The <code>tidyverse</code> provides a consistent framework for data manipulation, visualization, and modeling, which helps students learn generalizable skills rather than package-specific tricks.</p>
<p>A central concept in the <code>tidyverse</code> is the<code>tibble</code>, a modern re-imagining of the traditional R data frame. Tibbles keep the familiar two-dimensional table structure but introduce improvements such as preserving variable types, supporting list columns, and displaying data more cleanly in the console. These features make them easier to use in practice, especially with large datasets.</p>
<p>Finally, the idea of tidy data lies at the heart of the <code>tidyverse</code>. According to Hadley Wickham’s definition, tidy data means each variable forms a column, each observation forms a row, and each type of observational unit forms a table. Tidy data creates a standardized structure that enables smooth use of functions across the <code>tidyverse</code>, reducing the need for ad hoc data reshaping and making analyses more transparent and reproducible.</p>
</section>
<section id="tibbles" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="tibbles"><span class="header-section-number">8.2</span> Tibbles</h2>
<ul>
<li>What is a tibble?
<ul>
<li>Tibbles are data frames</li>
<li>But they try and enhance the regular “old” data frame from base R</li>
</ul></li>
<li>To learn more
<ul>
<li><code>vignette("tibble")</code></li>
</ul></li>
</ul>
<p>Tibbles are data frames that enhance the regular “old” data frame from base R. They keep the same two-dimensional tabular structure but are designed to be more consistent, predictable, and user-friendly.</p>
<section id="creating-tibbles" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="creating-tibbles"><span class="header-section-number">8.2.1</span> Creating tibbles</h3>
<p>There are several ways to create tibbles depending on the source of the data.</p>
<ul>
<li>From individual vectors</li>
</ul>
<p>The simplest way is to build a tibble directly from vectors using <code>tibble()</code>. Inputs of length 1 are automatically recycled, and you can refer to variables you just created:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">1</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> x <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> y</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["int"],"align":["right"]},{"label":["y"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["z"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"2"},{"1":"2","2":"1","3":"5"},{"1":"3","2":"1","3":"10"},{"1":"4","2":"1","3":"17"},{"1":"5","2":"1","3":"26"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>Converting existing objects</li>
</ul>
<p>You can convert existing data structures into tibbles with <code>as_tibble()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From a data frame</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as_tibble</span>(iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Sepal.Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sepal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Petal.Length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Petal.Width"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Species"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"5.1","2":"3.5","3":"1.4","4":"0.2","5":"setosa"},{"1":"4.9","2":"3.0","3":"1.4","4":"0.2","5":"setosa"},{"1":"4.7","2":"3.2","3":"1.3","4":"0.2","5":"setosa"},{"1":"4.6","2":"3.1","3":"1.5","4":"0.2","5":"setosa"},{"1":"5.0","2":"3.6","3":"1.4","4":"0.2","5":"setosa"},{"1":"5.4","2":"3.9","3":"1.7","4":"0.4","5":"setosa"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From a list</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">list</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["int"],"align":["right"]},{"label":["y"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"a"},{"1":"2","2":"b"},{"1":"3","2":"c"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>Reading from external files</li>
</ul>
<p>Packages in the tidyverse ecosystem return tibbles when reading data from files:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From CSV, TSV, or delimited text file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/Chetty_2014.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cz"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cz_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["state"],"name":[3],"type":["chr"],"align":["left"]},{"label":["region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["division"],"name":[5],"type":["chr"],"align":["left"]},{"label":["pop_2000"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["top_100"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["urban"],"name":[8],"type":["chr"],"align":["left"]},{"label":["rel_mobility"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["abs_mobility"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["prob_q1q5"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["frac_black"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["racial_seg"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["income_seg"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["poverty_seg"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["affluence_seg"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["frac_commute_under15"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["hhi_percap"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["gini"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["top1inc_share"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["gini_bottom99"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["frac_p25top75"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["taxrate"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["gov_exp"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["inctax_progressive"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["eitc"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["sch_exp"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["tchr_ratio"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["test_pctile"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["hs_dropout"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["colleges_percap"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["college_tuition"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["college_gradrate"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["labor_participation"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["manufacturing"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["growth_imports"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["teen_lfp"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["migration_in"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["migration_out"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["foreign_born"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["social_capital"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["frac_religious"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["crime_rate"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["frac_single_mothers"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["frac_divorced"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["frac_married"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["inc_growth"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["Urban or Rural"],"name":[48],"type":["chr"],"align":["left"]}],"data":[{"1":"100","2":"Johnson City","3":"TN","4":"South","5":"East South Central","6":"576081","7":"0","8":"urban","9":"0","10":"38","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.325","18":"31560","19":"0.468","20":"13.459","21":"0.333","22":"0.548","23":"0.020","24":"1886","25":"0","26":"0","27":"5.185","28":"NA","29":"2.728","30":"-0.015","31":"0.014","32":"4817","33":"-0.002","34":"0.587","35":"0.237","36":"5.294","37":"0.004","38":"0.006","39":"0.005","40":"0.012","41":"-0.298","42":"0.514","43":"0.001","44":"0.190","45":"0.110","46":"0.601","47":"-0.002","48":"#REF!"},{"1":"200","2":"Morristown","3":"TN","4":"South","5":"East South Central","6":"227816","7":"0","8":"urban","9":"0","10":"38","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.276","18":"29959","19":"0.435","20":"10.631","21":"0.328","22":"0.538","23":"0.023","24":"2004","25":"0","26":"0","27":"4.506","28":"NA","29":"-3.400","30":"-0.024","31":"0.009","32":"4762","33":"-0.101","34":"0.625","35":"0.238","36":"3.030","37":"0.005","38":"0.016","39":"0.014","40":"0.023","41":"-0.767","42":"0.544","43":"0.002","44":"0.185","45":"0.116","46":"0.613","47":"-0.002","48":"#REF!"},{"1":"301","2":"Middlesborough","3":"TN","4":"South","5":"East South Central","6":"66708","7":"0","8":"rural","9":"0","10":"39","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.359","18":"22328","19":"0.441","20":"10.691","21":"0.334","22":"0.467","23":"0.015","24":"1190","25":"0","26":"0","27":"5.614","28":"15.1","29":"-9.315","30":"-0.005","31":"0.045","32":"11840","33":"0.111","34":"0.479","35":"0.234","36":"2.063","37":"0.003","38":"0.008","39":"0.012","40":"0.007","41":"-1.270","42":"0.668","43":"0.001","44":"0.211","45":"0.113","46":"0.590","47":"-0.004","48":"#REF!"},{"1":"302","2":"Knoxville","3":"TN","4":"South","5":"East South Central","6":"727600","7":"1","8":"urban","9":"0","10":"38","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.269","18":"35884","19":"0.508","20":"15.080","21":"0.358","22":"0.504","23":"0.019","24":"2357","25":"0","26":"0","27":"4.900","28":"NA","29":"-6.032","30":"-0.011","31":"0.011","32":"3480","33":"-0.024","34":"0.615","35":"0.146","36":"1.078","37":"0.004","38":"0.016","39":"0.014","40":"0.020","41":"-0.222","42":"0.602","43":"0.001","44":"0.206","45":"0.114","46":"0.575","47":"-0.002","48":"#REF!"},{"1":"401","2":"Winston-Salem","3":"NC","4":"South","5":"South Atlantic","6":"493180","7":"0","8":"urban","9":"0","10":"37","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.292","18":"38892","19":"0.466","20":"11.917","21":"0.346","22":"0.500","23":"0.018","24":"1891","25":"1","26":"0","27":"5.463","28":"15.4","29":"-2.297","30":"0.023","31":"0.014","32":"9715","33":"0.052","34":"0.656","35":"0.215","36":"1.016","37":"0.004","38":"0.022","39":"0.019","40":"0.053","41":"-0.018","42":"0.488","43":"0.003","44":"0.220","45":"0.092","46":"0.586","47":"-0.014","48":"#REF!"},{"1":"402","2":"Martinsville","3":"VA","4":"South","5":"South Atlantic","6":"92753","7":"0","8":"rural","9":"0","10":"37","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0.313","18":"31265","19":"0.444","20":"10.680","21":"0.338","22":"0.538","23":"0.015","24":"1558","25":"0","26":"0","27":"5.740","28":"NA","29":"4.227","30":"NA","31":"0.011","32":"1113","33":"-0.116","34":"0.599","35":"0.395","36":"3.277","37":"0.003","38":"0.007","39":"0.010","40":"0.025","41":"-0.903","42":"0.454","43":"0.002","44":"0.241","45":"0.096","46":"0.580","47":"-0.011","48":"#REF!"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From Excel files</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># readxl::read_excel("data.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Reading from databases</li>
</ul>
<p>You can also obtain tibbles when working with databases using packages such as <code>DBI</code> and <code>dbplyr</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"mydb.sqlite"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"tablename"</span>)   <span class="co"># returns a tibble-like object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A tribble is a transposed tibble, designed for small data entry in code. Column headings are defined by formulas that start with <code>~</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x, <span class="sc">~</span>y, <span class="sc">~</span>z,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--|--|----</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"a"</span>, <span class="dv">2</span>, <span class="fl">3.6</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"b"</span>, <span class="dv">1</span>, <span class="fl">8.5</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["chr"],"align":["left"]},{"label":["y"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["z"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"a","2":"2","3":"3.6"},{"1":"b","2":"1","3":"8.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The <code>tibble</code> and <code>readr</code> packages are part of the core tidyverse, so they load automatically with <code>library(tidyverse)</code>. Other packages such as <code>readxl</code> and <code>dbplyr</code> belong to the tidyverse ecosystem. They follow the same principles and return tibbles, but you need to load them explicitly.</p>
</section>
<section id="features-of-tibbles" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="features-of-tibbles"><span class="header-section-number">8.2.2</span> Features of tibbles</h3>
<p>Tibbles make fewer automatic changes than base R data frames:</p>
<ul>
<li>They never change the type of inputs (strings are not converted to factors).</li>
<li>They never change variable names.</li>
<li>They never create row names.</li>
</ul>
<p>For example:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">:)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"smile"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"space"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2000</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"number"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These column names would not be valid in base R, but are allowed in a tibble.</p>
<p>There are two main differences between tibbles and base R data frames:</p>
<p><strong>Printing</strong> Tibbles have a refined print method that shows only the first 10 rows and only as many columns as fit on the screen:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> lubridate<span class="sc">::</span><span class="fu">now</span>() <span class="sc">+</span> <span class="fu">runif</span>(<span class="fl">1e3</span>) <span class="sc">*</span> <span class="dv">86400</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> lubridate<span class="sc">::</span><span class="fu">today</span>() <span class="sc">+</span> <span class="fu">runif</span>(<span class="fl">1e3</span>) <span class="sc">*</span> <span class="dv">30</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e3</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">runif</span>(<span class="fl">1e3</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">e =</span> <span class="fu">sample</span>(letters, <span class="fl">1e3</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["a"],"name":[1],"type":["dttm"],"align":["right"]},{"label":["b"],"name":[2],"type":["date"],"align":["right"]},{"label":["c"],"name":[3],"type":["int"],"align":["right"]},{"label":["d"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["e"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"2025-10-15 08:19:54.241468","2":"2025-11-09","3":"1","4":"0.6313018","5":"a"},{"1":"2025-10-15 04:22:27.539685","2":"2025-10-24","3":"2","4":"0.9948859","5":"p"},{"1":"2025-10-14 16:52:25.267894","2":"2025-11-04","3":"3","4":"0.6391869","5":"w"},{"1":"2025-10-15 07:16:28.002810","2":"2025-11-03","3":"4","4":"0.5467617","5":"g"},{"1":"2025-10-15 07:13:08.932415","2":"2025-10-31","3":"5","4":"0.6499452","5":"i"},{"1":"2025-10-14 11:38:34.246377","2":"2025-10-16","3":"6","4":"0.5713582","5":"m"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This design avoids overwhelming the console when printing large data frames.</p>
<p>If you need more output, you can adjust options:</p>
<ul>
<li><code>print(n = , width = )</code> controls number of rows and columns.</li>
<li>Global options can be set with:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.print_max =</span> n, <span class="at">tibble.print_min =</span> m)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.print_min =</span> <span class="cn">Inf</span>)     <span class="co"># always show all rows</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.width =</span> <span class="cn">Inf</span>)         <span class="co"># always print all columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Subsetting</strong> Most of the subsetting tools we have used so far generally subset the entire data frame. To pull out just a single variable or value, we can use <code>$</code> and <code>[[</code>: - <code>[[</code> extracts by name or position - <code>$</code> extracts by name with less typing</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">5</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract by name</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.93705938 0.89744407 0.30881152 0.01923029 0.52009777</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"x"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.93705938 0.89744407 0.30881152 0.01923029 0.52009777</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract by position</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.93705938 0.89744407 0.30881152 0.01923029 0.52009777</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="dv">1</span>,<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9370594</code></pre>
</div>
</div>
</section>
</section>
<section id="tidy-up-data" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="tidy-up-data"><span class="header-section-number">8.3</span> Tidy up data</h2>
<p>Structuring datasets to facilitate analysis is at the core of the principles of tidy data, as described by Hadley Wickham.</p>
<section id="tydy-data" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="tydy-data"><span class="header-section-number">8.3.1</span> Tydy data</h3>
<p>Tidy data follows three basic rules:</p>
<ul>
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each type of observational unit forms a table</li>
</ul>
<p>When these rules are not followed, the dataset is considered untidy. Common signs of untidy data include:</p>
<ul>
<li>Column headers are values instead of variable names</li>
<li>Multiple variables are stored in one column (for example, City_State)</li>
<li>Variables are stored in both rows and columns</li>
<li>Multiple types of observational units are stored in the same table</li>
<li>A single observational unit is stored in multiple tables</li>
<li>The dataset is either too long or too wide</li>
</ul>
</section>
<section id="pivoting" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="pivoting"><span class="header-section-number">8.3.2</span> Pivoting</h3>
<p>Most data encountered in practice will be untidy. This is because most people are not familiar with the principles of tidy data, and data is often organised to facilitate uses other than analysis, such as making entry easier.</p>
<p>Two common problems to look for are:</p>
<ul>
<li>One variable might be spread across multiple columns</li>
<li>One observation might be scattered across multiple rows</li>
</ul>
<p>Usually, a dataset will only suffer from one of these problems.</p>
<p>To resolve them, the <code>tidyr</code> package provides two key functions:</p>
<ul>
<li><code>pivot_longer()</code></li>
<li><code>pivot_wider()</code></li>
</ul>
<p>These functions are illustrated with example datasets included in the <code>tidyr</code> package. The tables (<code>table2</code>, <code>table4a</code>) contain data on the number of tuberculosis (TB) cases recorded in different countries for the years 1999 and 2000. The variable <code>cases</code> represents the number of TB cases reported for a given country, year, and type of measure.</p>
<section id="pivot-longer" class="level4" data-number="8.3.2.1">
<h4 data-number="8.3.2.1" class="anchored" data-anchor-id="pivot-longer"><span class="header-section-number">8.3.2.1</span> Pivot longer</h4>
<p>A common problem is a dataset where some of the column names are not variable names, but values of a variable:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>table4a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["1999"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["2000"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"745","3":"2666"},{"1":"Brazil","2":"37737","3":"80488"},{"1":"China","2":"212258","3":"213766"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>To tidy a dataset like this, pivot the offending columns into a new pair of variables.</p>
<p>Steps:</p>
<ul>
<li>Select the columns whose names are values, not variables. In this example, those are 1999 and 2000.</li>
<li>Choose the variable to move the column names to (here, <code>year</code>).</li>
<li>Choose the variable to move the column values to (here, <code>cases</code>).</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>table4a <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["chr"],"align":["left"]},{"label":["cases"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745"},{"1":"Afghanistan","2":"2000","3":"2666"},{"1":"Brazil","2":"1999","3":"37737"},{"1":"Brazil","2":"2000","3":"80488"},{"1":"China","2":"1999","3":"212258"},{"1":"China","2":"2000","3":"213766"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In the final result, the pivoted columns are dropped, and new year and cases columns are created. Other variables, such as country, are preserved. The <code>cases</code> column now explicitly records the number of TB cases for each year and country.</p>
</section>
</section>
<section id="pivot-wider" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="pivot-wider"><span class="header-section-number">8.3.3</span> Pivot wider</h3>
<p>Function <code>pivot_wider()</code> is the opposite of <code>pivot_longer()</code>. You use it when an observation is scattered across multiple rows.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["count"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"1999","3":"cases","4":"745"},{"1":"Afghanistan","2":"1999","3":"population","4":"19987071"},{"1":"Afghanistan","2":"2000","3":"cases","4":"2666"},{"1":"Afghanistan","2":"2000","3":"population","4":"20595360"},{"1":"Brazil","2":"1999","3":"cases","4":"37737"},{"1":"Brazil","2":"1999","3":"population","4":"172006362"},{"1":"Brazil","2":"2000","3":"cases","4":"80488"},{"1":"Brazil","2":"2000","3":"population","4":"174504898"},{"1":"China","2":"1999","3":"cases","4":"212258"},{"1":"China","2":"1999","3":"population","4":"1272915272"},{"1":"China","2":"2000","3":"cases","4":"213766"},{"1":"China","2":"2000","3":"population","4":"1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>To tidy this up, analyze the representation in a similar way to <code>pivot_longer()</code>:</p>
<ul>
<li>The column to take variable names from (here, type).</li>
<li>The column to take values from (here, count).</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>table2 <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> type, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cases"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["population"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745","4":"19987071"},{"1":"Afghanistan","2":"2000","3":"2666","4":"20595360"},{"1":"Brazil","2":"1999","3":"37737","4":"172006362"},{"1":"Brazil","2":"2000","3":"80488","4":"174504898"},{"1":"China","2":"1999","3":"212258","4":"1272915272"},{"1":"China","2":"2000","3":"213766","4":"1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In this result, values of <code>type</code> (cases and population) become separate columns, and their associated numbers from <code>count</code> fill in the values. This produces a clearer dataset where each row corresponds to a country and year with distinct variables for cases and population.</p>
</section>
<section id="separating" class="level3" data-number="8.3.4">
<h3 data-number="8.3.4" class="anchored" data-anchor-id="separating"><span class="header-section-number">8.3.4</span> Separating</h3>
<p>The <code>separate()</code> function is used to pull apart one column into multiple columns by splitting wherever a separator character appears. This is useful when a single column actually contains more than one variable.</p>
<p>Consider the dataset <code>table3</code> included in the <code>tidyr</code> package:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["rate"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745/19987071"},{"1":"Afghanistan","2":"2000","3":"2666/20595360"},{"1":"Brazil","2":"1999","3":"37737/172006362"},{"1":"Brazil","2":"2000","3":"80488/174504898"},{"1":"China","2":"1999","3":"212258/1272915272"},{"1":"China","2":"2000","3":"213766/1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Notice the <code>rate</code> column. It contains two variables combined into a single column: the number of cases and the population size, separated by a forward slash. To make the dataset tidy, these should be split into separate variables.</p>
<p>The <code>separate()</code> function takes the name of the column to split and the names of the new columns to create:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cases"],"name":[3],"type":["chr"],"align":["left"]},{"label":["population"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745","4":"19987071"},{"1":"Afghanistan","2":"2000","3":"2666","4":"20595360"},{"1":"Brazil","2":"1999","3":"37737","4":"172006362"},{"1":"Brazil","2":"2000","3":"80488","4":"174504898"},{"1":"China","2":"1999","3":"212258","4":"1272915272"},{"1":"China","2":"2000","3":"213766","4":"1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This produces two new columns, <code>cases</code> and <code>population</code>, replacing the original <code>rate</code> column. The new columns now contain integer values for the reported tuberculosis cases and the population in each country and year.</p>
<p>By default, <code>separate()</code> splits values wherever it sees a non-alphanumeric character, meaning any character that is not a number or letter. In the example above, it automatically detected and split at the forward slash.</p>
<p>If you want to be explicit, you can specify the character to split on with the <code>sep</code> argument:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>), <span class="at">sep =</span> <span class="st">"/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cases"],"name":[3],"type":["chr"],"align":["left"]},{"label":["population"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745","4":"19987071"},{"1":"Afghanistan","2":"2000","3":"2666","4":"20595360"},{"1":"Brazil","2":"1999","3":"37737","4":"172006362"},{"1":"Brazil","2":"2000","3":"80488","4":"174504898"},{"1":"China","2":"1999","3":"212258","4":"1272915272"},{"1":"China","2":"2000","3":"213766","4":"1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This ensures that the column is split exactly where expected, giving you clearer control over the separation process.</p>
</section>
<section id="unite" class="level3" data-number="8.3.5">
<h3 data-number="8.3.5" class="anchored" data-anchor-id="unite"><span class="header-section-number">8.3.5</span> Unite</h3>
<p>The <code>unite()</code> function is the inverse of <code>separate()</code>. It combines multiple columns into a single column. This can be useful when two or more variables are stored in separate columns but logically belong together.</p>
<p>Consider the dataset <code>table5</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>table5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["century"],"name":[2],"type":["chr"],"align":["left"]},{"label":["year"],"name":[3],"type":["chr"],"align":["left"]},{"label":["rate"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"19","3":"99","4":"745/19987071"},{"1":"Afghanistan","2":"20","3":"00","4":"2666/20595360"},{"1":"Brazil","2":"19","3":"99","4":"37737/172006362"},{"1":"Brazil","2":"20","3":"00","4":"80488/174504898"},{"1":"China","2":"19","3":"99","4":"212258/1272915272"},{"1":"China","2":"20","3":"00","4":"213766/1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In this table, the year of observation is split into two columns, <code>century</code> and <code>year</code>. To make the dataset easier to work with, we can combine these into a single column.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(new, century, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["new"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rate"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"19_99","3":"745/19987071"},{"1":"Afghanistan","2":"20_00","3":"2666/20595360"},{"1":"Brazil","2":"19_99","3":"37737/172006362"},{"1":"Brazil","2":"20_00","3":"80488/174504898"},{"1":"China","2":"19_99","3":"212258/1272915272"},{"1":"China","2":"20_00","3":"213766/1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>By default, <code>unite()</code> places an underscore (<code>_</code>) between the values from different columns. In this case, that would produce values like <code>19_99</code>.</p>
<p>If we want the numbers to run together without any separator, we can control this with the <code>sep</code> argument:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(new, century, year, <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["new"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rate"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Afghanistan","2":"1999","3":"745/19987071"},{"1":"Afghanistan","2":"2000","3":"2666/20595360"},{"1":"Brazil","2":"1999","3":"37737/172006362"},{"1":"Brazil","2":"2000","3":"80488/174504898"},{"1":"China","2":"1999","3":"212258/1272915272"},{"1":"China","2":"2000","3":"213766/1280428583"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This produces a single column <code>new</code> with values such as <code>1999</code> and <code>2000</code>, giving a cleaner representation of the year variable.</p>
</section>
</section>
<section id="relational-data" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="relational-data"><span class="header-section-number">8.4</span> Relational Data</h2>
<p>Many datasets consist of multiple tables that are connected in a meaningful way. Together, such collections are called <em>relational data</em>. Each table stores information about a particular type of observation, and the relationships among these tables allow us to draw richer conclusions.</p>
<p>Why not store everything in one giant table? Because different kinds of observations naturally belong in different tables. For example, aircraft information does not change across flights, and weather data apply to all flights departing at a specific time from the same airport.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think: Storage Efficiency and Consistency
</div>
</div>
<div class="callout-body-container callout-body">
<p>Keeping separate tables avoids duplication, reduces storage, and prevents inconsistencies when information changes. If the manufacturer name of a plane changes, updating one record in the <code>planes</code> table is enough, rather than updating thousands of flight records.</p>
</div>
</div>
<section id="introduction-1" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">8.4.1</span> Introduction</h3>
<p>We use the <code>nycflights13</code> package as an example again to illustrate. This package includes several tables describing all flights departing New York City in 2013.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(year<span class="sc">:</span>day, hour, origin, dest, tailnum, carrier) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["int"],"align":["right"]},{"label":["month"],"name":[2],"type":["int"],"align":["right"]},{"label":["day"],"name":[3],"type":["int"],"align":["right"]},{"label":["hour"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["origin"],"name":[5],"type":["chr"],"align":["left"]},{"label":["dest"],"name":[6],"type":["chr"],"align":["left"]},{"label":["tailnum"],"name":[7],"type":["chr"],"align":["left"]},{"label":["carrier"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"2013","2":"1","3":"1","4":"5","5":"EWR","6":"IAH","7":"N14228","8":"UA"},{"1":"2013","2":"1","3":"1","4":"5","5":"LGA","6":"IAH","7":"N24211","8":"UA"},{"1":"2013","2":"1","3":"1","4":"5","5":"JFK","6":"MIA","7":"N619AA","8":"AA"},{"1":"2013","2":"1","3":"1","4":"5","5":"JFK","6":"BQN","7":"N804JB","8":"B6"},{"1":"2013","2":"1","3":"1","4":"6","5":"LGA","6":"ATL","7":"N668DN","8":"DL"},{"1":"2013","2":"1","3":"1","4":"5","5":"EWR","6":"ORD","7":"N39463","8":"UA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>airlines <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["carrier"],"name":[1],"type":["chr"],"align":["left"]},{"label":["name"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"9E","2":"Endeavor Air Inc."},{"1":"AA","2":"American Airlines Inc."},{"1":"AS","2":"Alaska Airlines Inc."},{"1":"B6","2":"JetBlue Airways"},{"1":"DL","2":"Delta Air Lines Inc."},{"1":"EV","2":"ExpressJet Airlines Inc."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>planes <span class="sc">%&gt;%</span> <span class="fu">select</span>(tailnum, manufacturer, model, year) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["tailnum"],"name":[1],"type":["chr"],"align":["left"]},{"label":["manufacturer"],"name":[2],"type":["chr"],"align":["left"]},{"label":["model"],"name":[3],"type":["chr"],"align":["left"]},{"label":["year"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"N10156","2":"EMBRAER","3":"EMB-145XR","4":"2004"},{"1":"N102UW","2":"AIRBUS INDUSTRIE","3":"A320-214","4":"1998"},{"1":"N103US","2":"AIRBUS INDUSTRIE","3":"A320-214","4":"1999"},{"1":"N104UW","2":"AIRBUS INDUSTRIE","3":"A320-214","4":"1999"},{"1":"N10575","2":"EMBRAER","3":"EMB-145LR","4":"2002"},{"1":"N105UW","2":"AIRBUS INDUSTRIE","3":"A320-214","4":"1999"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">select</span>(faa, name, lat, lon) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["faa"],"name":[1],"type":["chr"],"align":["left"]},{"label":["name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["lat"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"04G","2":"Lansdowne Airport","3":"41.13047","4":"-80.61958"},{"1":"06A","2":"Moton Field Municipal Airport","3":"32.46057","4":"-85.68003"},{"1":"06C","2":"Schaumburg Regional","3":"41.98934","4":"-88.10124"},{"1":"06N","2":"Randall Airport","3":"41.43191","4":"-74.39156"},{"1":"09J","2":"Jekyll Island Airport","3":"31.07447","4":"-81.42778"},{"1":"0A9","2":"Elizabethton Municipal Airport","3":"36.37122","4":"-82.17342"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span> <span class="fu">select</span>(origin, year<span class="sc">:</span>day, hour, temp, wind_speed) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["origin"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["int"],"align":["right"]},{"label":["month"],"name":[3],"type":["int"],"align":["right"]},{"label":["day"],"name":[4],"type":["int"],"align":["right"]},{"label":["hour"],"name":[5],"type":["int"],"align":["right"]},{"label":["temp"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["wind_speed"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"EWR","2":"2013","3":"1","4":"1","5":"1","6":"39.02","7":"10.35702"},{"1":"EWR","2":"2013","3":"1","4":"1","5":"2","6":"39.02","7":"8.05546"},{"1":"EWR","2":"2013","3":"1","4":"1","5":"3","6":"39.02","7":"11.50780"},{"1":"EWR","2":"2013","3":"1","4":"1","5":"4","6":"39.92","7":"12.65858"},{"1":"EWR","2":"2013","3":"1","4":"1","5":"5","6":"39.02","7":"12.65858"},{"1":"EWR","2":"2013","3":"1","4":"1","5":"6","6":"37.94","7":"11.50780"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Each table contains different but related information:</p>
<ul>
<li><code>flights</code> records each departure, including date, time, origin, destination, tail number, and carrier code.</li>
<li><code>airlines</code> provides the full airline names corresponding to carrier codes.</li>
<li><code>airports</code> gives the name and geographic location for each airport.</li>
<li><code>planes</code> contains aircraft details such as manufacturer and model.</li>
<li><code>weather</code> records hourly weather data for each origin airport.</li>
</ul>
<p>These tables are linked by shared variables. For example:</p>
<ul>
<li><code>carrier</code> links <code>flights</code> to <code>airlines</code>.</li>
<li><code>tailnum</code> links <code>flights</code> to <code>planes</code>.</li>
<li><code>origin</code> and <code>dest</code> link <code>flights</code> to <code>airports</code>.</li>
<li><code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, and <code>origin</code> link <code>flights</code> to <code>weather</code>.</li>
</ul>
<p>A natural question to ask is: how can we combine information across these tables to answer questions such as:</p>
<ol type="1">
<li>What type of aircraft fly most often from JFK?</li>
<li>Which airlines experience the longest delays?</li>
<li>Are certain weather conditions associated with longer delays?</li>
</ol>
<p>To answer these questions, we must understand <em>keys</em> and <em>joins</em>.</p>
</section>
<section id="keys-and-relationships" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="keys-and-relationships"><span class="header-section-number">8.4.2</span> Keys and Relationships</h3>
<p>A key identifies how observations in one table relate to those in another.</p>
<ul>
<li>A primary key uniquely identifies each observation within a table.</li>
<li>A foreign key refers to a primary key in another table.</li>
</ul>
<p>For example, in <code>planes</code>, the variable <code>tailnum</code> serves as a primary key because each aircraft has a unique tail number. In <code>flights</code>, the same variable acts as a foreign key since many flights can share the same aircraft.</p>
<p>We can verify whether a variable is a primary key by checking for uniqueness:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>planes <span class="sc">%&gt;%</span> <span class="fu">count</span>(tailnum) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["tailnum"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>No duplicates imply that <code>tailnum</code> is a valid primary key. We can also check whether every <code>tailnum</code> in <code>flights</code> appears in <code>planes</code> once we learn about filtering joins below.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think: Diagnosing Key Issues
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s common for foreign keys to have missing matches. This may happen when aircraft were retired, renamed, or missing from the record. Always check unmatched keys before joining tables.</p>
</div>
</div>
</section>
<section id="mutating-joins" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="mutating-joins"><span class="header-section-number">8.4.3</span> Mutating Joins</h3>
<p>Mutating joins combine variables from two tables based on matching key values. They allow us to enrich one dataset with information from another.</p>
<p>There are four types of mutating Joins:</p>
<ul>
<li><code>inner_join(x, y)</code>: keeps only rows with matching keys in both tables.</li>
<li><code>left_join(x, y)</code>: keeps all rows from <code>x</code>, adding matches from <code>y</code>.</li>
<li><code>right_join(x, y)</code>: keeps all rows from <code>y</code>, adding matches from <code>x</code>.</li>
<li><code>full_join(x, y)</code>: keeps all rows from both tables.</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(year<span class="sc">:</span>day, hour, origin, dest, tailnum, carrier)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> flights2 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="do">## compare dimensions</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(flights2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776</code></pre>
</div>
</div>
<p>The number of rows in the result matches <code>flights2</code> because <code>left_join()</code> keeps all flights, even those without matching <code>tailnum</code> records. Missing values appear for unmatched aircraft.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think: Choosing the Right Join
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>left_join()</code> is most common because it preserves the main dataset. Use <code>inner_join()</code> only when you are sure you want to exclude records that do not match.</p>
</div>
</div>
</section>
<section id="filtering-joins" class="level3" data-number="8.4.4">
<h3 data-number="8.4.4" class="anchored" data-anchor-id="filtering-joins"><span class="header-section-number">8.4.4</span> Filtering Joins</h3>
<p>Filtering joins keep or exclude observations in one table based on whether they have a match in another. They do not add new columns.</p>
<ul>
<li><code>semi_join(x, y)</code>: keeps rows in <code>x</code> that have a match in <code>y</code>.</li>
<li><code>anti_join(x, y)</code>: keeps rows in <code>x</code> that do not have a match in <code>y</code>.</li>
</ul>
<p><strong>Example</strong>: Flights with Known Planes</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 284170</code></pre>
</div>
</div>
<p>This keeps only flights that have aircraft information in <code>planes</code>.</p>
<p><strong>Example</strong>: Flights with Unknown Planes</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52606</code></pre>
</div>
</div>
<p>These flights are missing aircraft details. <code>anti_join()</code> is especially useful for finding unmatched keys and diagnosing data quality issues. For instance, you might use it to identify which flights are missing weather information or which airports have no corresponding records.</p>
<p>This is how we check how many flights lack corresponding aircraft information</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52606</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think: Using <code>semi_join()</code> and <code>anti_join()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>semi_join()</code> to filter data based on membership, and <code>anti_join()</code> to find mismatches. They are efficient tools for quality control and exploratory checks.</p>
</div>
</div>
</section>
<section id="summary" class="level3" data-number="8.4.5">
<h3 data-number="8.4.5" class="anchored" data-anchor-id="summary"><span class="header-section-number">8.4.5</span> Summary</h3>
<p>Relational data represent multiple connected tables describing related entities. Keeping separate tables helps minimize redundancy, reduce errors, and maintain data consistency. Understanding how these tables are linked through keys allows us to integrate information accurately. The tidyverse join functions make it straightforward to enrich, filter, and explore relational datasets such as the <code>nycflights13</code> example.</p>
</section>
</section>
<section id="strings" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="strings"><span class="header-section-number">8.5</span> Strings</h2>
<p>Text data are common in real datasets. In the NYC flights example, variables such as airline names, airport codes, or weather descriptions are stored as strings. Because text data often includes noise, inconsistent capitalization, or embedded structure (like “city–state”), knowing how how to inspect, clean, and manipulate string variables is essential before analysis. The <code>stringr</code> package from the tidyverse offers consistent, easy-to-remember functions for string operations.</p>
<section id="vectorized-string-operations" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="vectorized-string-operations"><span class="header-section-number">8.5.1</span> Vectorized String Operations</h3>
<p>String functions in R are vectorized, meaning they act on each element of a vector. Let us look at examples using the airline names from the flights data.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>airlines<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Endeavor Air Inc."           "American Airlines Inc."     
 [3] "Alaska Airlines Inc."        "JetBlue Airways"            
 [5] "Delta Air Lines Inc."        "ExpressJet Airlines Inc."   
 [7] "Frontier Airlines Inc."      "AirTran Airways Corporation"
 [9] "Hawaiian Airlines Inc."      "Envoy Air"                  
[11] "SkyWest Airlines Inc."       "United Air Lines Inc."      
[13] "US Airways Inc."             "Virgin America"             
[15] "Southwest Airlines Co."      "Mesa Airlines Inc."         </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(airlines<span class="sc">$</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 17 22 20 15 20 24 22 27 22  9 21 21 15 14 22 18</code></pre>
</div>
</div>
<p>The function <code>str_length()</code> returns the number of characters in each element. Vectorization allows us to compute results for all airlines at once.</p>
<p>We can combine strings with <code>str_c()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"Flight to"</span>, airlines<span class="sc">$</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Flight toEndeavor Air Inc."          
 [2] "Flight toAmerican Airlines Inc."     
 [3] "Flight toAlaska Airlines Inc."       
 [4] "Flight toJetBlue Airways"            
 [5] "Flight toDelta Air Lines Inc."       
 [6] "Flight toExpressJet Airlines Inc."   
 [7] "Flight toFrontier Airlines Inc."     
 [8] "Flight toAirTran Airways Corporation"
 [9] "Flight toHawaiian Airlines Inc."     
[10] "Flight toEnvoy Air"                  
[11] "Flight toSkyWest Airlines Inc."      
[12] "Flight toUnited Air Lines Inc."      
[13] "Flight toUS Airways Inc."            
[14] "Flight toVirgin America"             
[15] "Flight toSouthwest Airlines Co."     
[16] "Flight toMesa Airlines Inc."         </code></pre>
</div>
</div>
<p>This is not exactly what we wanted, because the default <code>sep = ""</code>. We should add <code>sep = " "</code>.</p>
<p>We can extract substrings with <code>str_sub()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(airlines<span class="sc">$</span>name, <span class="dv">1</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "End" "Ame" "Ala" "Jet" "Del" "Exp" "Fro" "Air" "Haw" "Env" "Sky" "Uni"
[13] "US " "Vir" "Sou" "Mes"</code></pre>
</div>
</div>
<p>Simply put, <code>str_c()</code> joins elements with an optional separator. <code>str_sub()</code> extracts a substring between given positions. Both are vectorized.</p>
</section>
<section id="pattern-detection-and-replacement" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="pattern-detection-and-replacement"><span class="header-section-number">8.5.2</span> Pattern Detection and Replacement</h3>
<p>Pattern matching is powerful for cleaning string variables. Suppose we want to know which airlines have names containing the word <em>Air</em>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(airlines<span class="sc">$</span>name, <span class="st">"Air"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
[13]  TRUE FALSE  TRUE  TRUE</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(airlines<span class="sc">$</span>name, <span class="st">"Air"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Endeavor Air Inc."           "American Airlines Inc."     
 [3] "Alaska Airlines Inc."        "JetBlue Airways"            
 [5] "Delta Air Lines Inc."        "ExpressJet Airlines Inc."   
 [7] "Frontier Airlines Inc."      "AirTran Airways Corporation"
 [9] "Hawaiian Airlines Inc."      "Envoy Air"                  
[11] "SkyWest Airlines Inc."       "United Air Lines Inc."      
[13] "US Airways Inc."             "Southwest Airlines Co."     
[15] "Mesa Airlines Inc."         </code></pre>
</div>
</div>
<p>To replace part of a string, use <code>str_replace()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(airlines<span class="sc">$</span>name, <span class="st">"Air"</span>, <span class="st">"Sky"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Endeavor Sky Inc."           "American Skylines Inc."     
 [3] "Alaska Skylines Inc."        "JetBlue Skyways"            
 [5] "Delta Sky Lines Inc."        "ExpressJet Skylines Inc."   
 [7] "Frontier Skylines Inc."      "SkyTran Airways Corporation"
 [9] "Hawaiian Skylines Inc."      "Envoy Sky"                  
[11] "SkyWest Skylines Inc."       "United Sky Lines Inc."      
[13] "US Skyways Inc."             "Virgin America"             
[15] "Southwest Skylines Co."      "Mesa Skylines Inc."         </code></pre>
</div>
</div>
<p>Note the differences + <code>str_replace()</code> replaces only the first occurrence of a pattern in each string. + <code>str_replace_all()</code> replaces all occurrences of the pattern in each string.</p>
<p>Regular expressions can be used for flexible pattern specification. The following example finds airline names ending with <em>Lines</em>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(airlines<span class="sc">$</span>name, <span class="st">"Air$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Envoy Air"</code></pre>
</div>
</div>
</section>
<section id="splitting-and-joining-strings" class="level3" data-number="8.5.3">
<h3 data-number="8.5.3" class="anchored" data-anchor-id="splitting-and-joining-strings"><span class="header-section-number">8.5.3</span> Splitting and Joining Strings</h3>
<p>When a variable contains multiple pieces of information in one column, we can split it into parts. For instance, separate origin and destination in a route.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>routes <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">route =</span> <span class="fu">str_c</span>(origin, dest, <span class="at">sep =</span> <span class="st">"-&gt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(route)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(routes<span class="sc">$</span>route)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "EWR-&gt;IAH" "LGA-&gt;IAH" "JFK-&gt;MIA" "JFK-&gt;BQN" "LGA-&gt;ATL" "EWR-&gt;ORD"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="fu">head</span>(routes<span class="sc">$</span>route), <span class="st">"-&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "EWR" "IAH"

[[2]]
[1] "LGA" "IAH"

[[3]]
[1] "JFK" "MIA"

[[4]]
[1] "JFK" "BQN"

[[5]]
[1] "LGA" "ATL"

[[6]]
[1] "EWR" "ORD"</code></pre>
</div>
</div>
<p>Function <code>str_split()</code> returns a list because each element may contain a different number of splits. Use <code>str_c()</code> or <code>str_flatten()</code> to join pieces again.</p>
</section>
</section>
<section id="factors" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="factors"><span class="header-section-number">8.6</span> Factors</h2>
<p>String variables often represent categorical information, such as airline names, weather conditions, or airport codes. In R, categorical data are better stored as <code>factors</code>, which record the unique categories (called <code>levels</code>) and store the data as integer codes internally. The <code>forcats</code> package provide utilities to handle such tasks.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>flights<span class="sc">$</span>carrier <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UA" "UA" "AA" "B6" "DL" "UA"</code></pre>
</div>
</div>
<p>The <code>carrier</code> variable is currently a string. We can convert it to a factor using <code>as_factor()</code> or <code>factor()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">carrier =</span> <span class="fu">as_factor</span>(carrier))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(flights<span class="sc">$</span>carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "UA" "AA" "B6" "DL" "EV" "MQ" "US" "WN" "VX" "FL" "AS" "9E" "F9" "HA" "YV"
[16] "OO"</code></pre>
</div>
</div>
<p>Each unique airline code becomes a level. Internally, R stores these levels as integers, which saves memory and allows efficient grouping.</p>
<section id="ordering-factors" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="ordering-factors"><span class="header-section-number">8.6.1</span> Ordering Factors</h3>
<p>Sometimes categories have a natural order, such as flight status (early, on time, late). Ordered factors preserve that ordering for display and modeling.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"on time"</span>, <span class="st">"late"</span>, <span class="st">"early"</span>),</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"early"</span>, <span class="st">"on time"</span>, <span class="st">"late"</span>),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] on time late    early  
Levels: early &lt; on time &lt; late</code></pre>
</div>
</div>
</section>
<section id="relabeling-factors" class="level3" data-number="8.6.2">
<h3 data-number="8.6.2" class="anchored" data-anchor-id="relabeling-factors"><span class="header-section-number">8.6.2</span> Relabeling Factors</h3>
<p>We often need to rename levels for clarity. The <strong>forcats</strong> package provides functions like <code>fct_recode()</code> and <code>fct_collapse()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">carrier =</span> <span class="fu">fct_recode</span>(carrier,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"United"</span> <span class="ot">=</span> <span class="st">"UA"</span>,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> <span class="st">"DL"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"American"</span> <span class="ot">=</span> <span class="st">"AA"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Southwest"</span> <span class="ot">=</span> <span class="st">"WN"</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(flights<span class="sc">$</span>carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "United"    "American"  "B6"        "Delta"     "EV"        "MQ"       
 [7] "US"        "Southwest" "VX"        "FL"        "AS"        "9E"       
[13] "F9"        "HA"        "YV"        "OO"       </code></pre>
</div>
</div>
</section>
<section id="frequency-and-reordering" class="level3" data-number="8.6.3">
<h3 data-number="8.6.3" class="anchored" data-anchor-id="frequency-and-reordering"><span class="header-section-number">8.6.3</span> Frequency and Reordering</h3>
<p>Factors can be reordered to reflect frequencies or another variable. For instance, we can order airlines by the number of flights.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">carrier =</span> <span class="fu">fct_reorder</span>(carrier, n)) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08-tidy_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This visualization shows the most frequent carriers at the top. The <code>fct_reorder()</code> function makes the plot easier to interpret.</p>
</section>
<section id="dropping-unused-levels" class="level3" data-number="8.6.4">
<h3 data-number="8.6.4" class="anchored" data-anchor-id="dropping-unused-levels"><span class="header-section-number">8.6.4</span> Dropping Unused Levels</h3>
<p>If we filter a dataset, some factor levels may no longer appear. We can remove them using <code>fct_drop()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(carrier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Delta"</span>, <span class="st">"United"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">carrier =</span> <span class="fu">fct_drop</span>(carrier)) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["carrier"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"United","2":"58665"},{"1":"Delta","2":"48110"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Proper factor handling ensures consistent grouping and clean visualization.</p>
</section>
</section>
<section id="datetime" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="datetime"><span class="header-section-number">8.7</span> Date/Time</h2>
<p>Flight departure and arrival times are examples of temporal data. The <code>lubridate</code> package makes it easier to parse and manipulate date-time values.</p>
<section id="parsing-date-and-time" class="level3" data-number="8.7.1">
<h3 data-number="8.7.1" class="anchored" data-anchor-id="parsing-date-and-time"><span class="header-section-number">8.7.1</span> Parsing Date and Time</h3>
<p>Package <code>lubridate</code> automatically recognizes common formats. Depending on whether the string starts with year, month, or day, we use different functions.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">"2025-10-07"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-07"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"October 7, 2025"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-07"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">"07-10-2025"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-07"</code></pre>
</div>
</div>
<p>These functions convert text to proper <code>Date</code> objects and eliminate format ambiguities.</p>
<p>The flights data include <code>year</code>, <code>month</code>, and <code>day</code> variables. The function <code>make_date()</code> combines them into a single <code>Date</code> column.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">fdate =</span> <span class="fu">make_date</span>(year, month, day))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, month, day, fdate) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["int"],"align":["right"]},{"label":["month"],"name":[2],"type":["int"],"align":["right"]},{"label":["day"],"name":[3],"type":["int"],"align":["right"]},{"label":["fdate"],"name":[4],"type":["date"],"align":["right"]}],"data":[{"1":"2013","2":"1","3":"1","4":"2013-01-01"},{"1":"2013","2":"1","3":"1","4":"2013-01-01"},{"1":"2013","2":"1","3":"1","4":"2013-01-01"},{"1":"2013","2":"1","3":"1","4":"2013-01-01"},{"1":"2013","2":"1","3":"1","4":"2013-01-01"},{"1":"2013","2":"1","3":"1","4":"2013-01-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>For date-times that include hours and minutes, <code>make_datetime()</code> is used:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dep_dt =</span> <span class="fu">make_datetime</span>(year, month, day,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                                  dep_time <span class="sc">%/%</span> <span class="dv">100</span>, dep_time <span class="sc">%%</span> <span class="dv">100</span>))</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_time, dep_dt) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["dep_time"],"name":[1],"type":["int"],"align":["right"]},{"label":["dep_dt"],"name":[2],"type":["dttm"],"align":["right"]}],"data":[{"1":"517","2":"2013-01-01 05:17:00"},{"1":"533","2":"2013-01-01 05:33:00"},{"1":"542","2":"2013-01-01 05:42:00"},{"1":"544","2":"2013-01-01 05:44:00"},{"1":"554","2":"2013-01-01 05:54:00"},{"1":"554","2":"2013-01-01 05:54:00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="extracting-components" class="level3" data-number="8.7.2">
<h3 data-number="8.7.2" class="anchored" data-anchor-id="extracting-components"><span class="header-section-number">8.7.2</span> Extracting Components</h3>
<p>Once a date-time object is created, components such as year, month, and hour can be extracted easily.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>date_example <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2025-10-07 14:30:00"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(date_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2025</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(date_example, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Oct
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(date_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(date_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
</section>
<section id="date-arithmetic" class="level3" data-number="8.7.3">
<h3 data-number="8.7.3" class="anchored" data-anchor-id="date-arithmetic"><span class="header-section-number">8.7.3</span> Date Arithmetic</h3>
<p>Arithmetic operations work naturally on date-time objects.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>date_example <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-17 14:30:00 UTC"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>date_example <span class="sc">-</span> <span class="fu">hours</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-07 09:30:00 UTC"</code></pre>
</div>
</div>
<p>Delays between departure and arrival can be computed by subtraction:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">arr_dt =</span> <span class="fu">make_datetime</span>(year, month, day,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                                  arr_time <span class="sc">%/%</span> <span class="dv">100</span>, arr_time <span class="sc">%%</span> <span class="dv">100</span>),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">delay_mins =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(arr_dt, dep_dt,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">units =</span> <span class="st">"mins"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(dep_dt, arr_dt, delay_mins) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["dep_dt"],"name":[1],"type":["dttm"],"align":["right"]},{"label":["arr_dt"],"name":[2],"type":["dttm"],"align":["right"]},{"label":["delay_mins"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2013-01-01 05:17:00","2":"2013-01-01 08:30:00","3":"193"},{"1":"2013-01-01 05:33:00","2":"2013-01-01 08:50:00","3":"197"},{"1":"2013-01-01 05:42:00","2":"2013-01-01 09:23:00","3":"221"},{"1":"2013-01-01 05:44:00","2":"2013-01-01 10:04:00","3":"260"},{"1":"2013-01-01 05:54:00","2":"2013-01-01 08:12:00","3":"138"},{"1":"2013-01-01 05:54:00","2":"2013-01-01 07:40:00","3":"106"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="example-average-delay-by-hour" class="level3" data-number="8.7.4">
<h3 data-number="8.7.4" class="anchored" data-anchor-id="example-average-delay-by-hour"><span class="header-section-number">8.7.4</span> Example: Average Delay by Hour</h3>
<p>We can examine how departure delays vary by hour of the day.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dep_dt =</span> <span class="fu">make_datetime</span>(year, month, day,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                                  dep_time <span class="sc">%/%</span> <span class="dv">100</span>, dep_time <span class="sc">%%</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="at">hour =</span> <span class="fu">hour</span>(dep_dt)) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(hour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["hour"],"name":[1],"type":["int"],"align":["right"]},{"label":["mean_delay"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"126.6098901"},{"1":"1","2":"207.0493274"},{"1":"2","2":"239.9218750"},{"1":"3","2":"304.7272727"},{"1":"4","2":"-5.5540984"},{"1":"5","2":"-4.3556445"},{"1":"6","2":"-1.5205516"},{"1":"7","2":"0.2232888"},{"1":"8","2":"1.0914320"},{"1":"9","2":"4.2682953"},{"1":"10","2":"5.5486439"},{"1":"11","2":"5.6523088"},{"1":"12","2":"7.6018916"},{"1":"13","2":"9.3806394"},{"1":"14","2":"8.0903809"},{"1":"15","2":"10.6820490"},{"1":"16","2":"13.6211497"},{"1":"17","2":"16.7565932"},{"1":"18","2":"18.6646712"},{"1":"19","2":"21.4973420"},{"1":"20","2":"28.2662129"},{"1":"21","2":"42.0649635"},{"1":"22","2":"68.1900419"},{"1":"23","2":"96.9468654"},{"1":"NA","2":"NaN"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07-eda.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./exercises.html" class="pagination-link" aria-label="Exercises">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exercises</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/statds/1010f25/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/statds/1010f25/blob/main/08-tidy.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>